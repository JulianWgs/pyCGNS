#!/usr/bin/env python
#  -------------------------------------------------------------------------
#  pyCGNS.VAL - Python package for CFD General Notation System - VALidater
#  See license.txt file in the root directory of this Python module source  
#  -------------------------------------------------------------------------
#
import getopt
import sys
import os

from CGNS.pyCGNSconfig import version as __vid__
import CGNS.VAL.simplecheck as CGV
import CGNS.MAP
from CGNS.VAL import __vid__

def usage():
  print """CGNS.VAL v%s
  CGNS.VAL [options] file.hdf
  -p <path> : start check at this node
  -f : flat mode, do not recurse on tree
  -u : check user requirements
  -r <idlist> : remove the list of ids ( -r U012:U023:U001 )
  -m : Output by message id instead of path
  -h : help
  -v : verbose (trace)
  """%__vid__
  sys.exit(-1)

try:
 opts, args = getopt.getopt(sys.argv[1:], "mfhvur:p:")
except getopt.GetoptError:
 usage()

verbose=False
recurse=True
user=False
pathsort=True
olist=[]
idlist=[]

try:
  filename=args[0]
except IndexError:
  usage()
  
for o, v in opts:
  if (o == "-f"): recurse=False
  if (o == "-m"): pathsort=False
  if (o == "-p"): path=v
  if (o == "-v"): verbose=True
  if (o == "-u"): user=True
  if (o == "-r"): idlist=v.split(':')
  if (o in ("-h", "--help")): usage()

if (verbose):
  print '### CGNS.VAL %s'%__vid__
  print '### Loading file [%s]'%filename
(tree,links,paths,diag)=CGNS.MAP.load2(filename,CGNS.MAP.S2P_DEFAULTS,
                                       lksearch=['.'],maxdata=200)

checkdiag=CGV.run(tree,verbose,user)
if (verbose): CGV.showDiag(checkdiag,idlist,bypath=pathsort)

# --- last line
